global:
    seperator: ","
    name: acs
    use_schema: True
    source : "data/acs/<sumlevel>_<tbl>_<column>.json"
    filetype: json
    source_vars:
        sumlevel: ["state", "county"]
        tbl: ["B06001"]
        column:
          start: 14
          end: 60
          zfill: 3

    preprocess:
      func: "src.plugins.preprocess.acs_preprocess"

    output : "data/output/acs/<sumlevel>_<tbl>_<column>"

    web_paths: "http://api.census.gov/data/2013/acs5?get=GEOID,<tbl>_<column>E,<tbl>_<column>M&for=<sumlevel>&key=$ACS_KEY"
    concat: YES

    import_to_db: True
    db_settings:
        user: postgres
        password_env_var: DATAUSA_PW
        host: 162.209.124.219
        db_name: datausa

    regex_drop:
        "B06001_0(25|37|49)<e_m>": "delete"

    transform:
      - type: drop
        strict: NO
        column: [tbl, sumlevel, column, state, county]

    post_agg_transform:
      - type: add
        column: us_under_5E
        values: ["[B06001_014E]", "[B06001_026E]", "[B06001_038E]"]
        drop: YES
      - type: combine_moes
        confidence: 0.9
        column: us_under_5M
        values: ["B06001_014M", "B06001_026M", "B06001_038M"]
        drop: YES
      - type: add
        column: us_5_to_17E
        values: ["[B06001_015E]", "[B06001_027E]", "[B06001_039E]"]
        drop: YES
      - type: combine_moes
        confidence: 0.9
        column: us_5_to_17M
        values: ["B06001_015M", "B06001_027M", "B06001_039M"]
        drop: YES
      - type: add
        column: us_18_to_24E
        values: ["[B06001_016E]", "[B06001_028E]", "[B06001_040E]"]
        drop: YES
      - type: combine_moes
        confidence: 0.9
        column: us_18_to_24M
        values: ["B06001_016M", "B06001_028M", "B06001_040M"]
        drop: YES
      - type: add
        column: us_25_to_34E
        values: ["[B06001_017E]", "[B06001_029E]", "[B06001_041E]"]
        drop: YES
      - type: combine_moes
        confidence: 0.9
        column: us_25_to_34M
        values: ["B06001_017M", "B06001_029M", "B06001_041M"]
        drop: YES
      - type: add
        column: us_35_to_44E
        values: ["[B06001_018E]", "[B06001_030E]", "[B06001_042E]"]
        drop: YES
      - type: combine_moes
        confidence: 0.9
        column: us_35_to_44M
        values: ["B06001_018M", "B06001_030M", "B06001_042M"]
        drop: YES
      - type: add
        column: us_45_to_54E
        values: ["[B06001_019E]", "[B06001_031E]", "[B06001_043E]"]
        drop: YES
      - type: combine_moes
        confidence: 0.9
        column: us_45_to_54M
        values: ["B06001_019M", "B06001_031M", "B06001_043M"]
        drop: YES
      - type: add
        column: us_55_to_59E
        values: ["[B06001_020E]", "[B06001_032E]", "[B06001_044E]"]
        drop: YES
      - type: combine_moes
        confidence: 0.9
        column: us_55_to_59M
        values: ["B06001_020M", "B06001_032M", "B06001_044M"]
        drop: YES
      - type: add
        column: us_60_to_61E
        values: ["[B06001_021E]", "[B06001_033E]", "[B06001_045E]"]
        drop: YES
      - type: combine_moes
        confidence: 0.9
        column: us_60_to_61M
        values: ["B06001_021M", "B06001_033M", "B06001_045M"]
        drop: YES
      - type: add
        column: us_62_to_64E
        values: ["[B06001_022E]", "[B06001_034E]", "[B06001_046E]"]
        drop: YES
      - type: combine_moes
        confidence: 0.9
        column: us_62_to_64M
        values: ["B06001_022M", "B06001_034M", "B06001_046M"]
        drop: YES
      - type: add
        column: us_65_to_74E
        values: ["[B06001_023E]", "[B06001_035E]", "[B06001_047E]"]
        drop: YES
      - type: combine_moes
        confidence: 0.9
        column: us_65_to_74M
        values: ["B06001_023M", "B06001_035M", "B06001_047M"]
        drop: YES
      - type: add
        column: us_75_and_overE
        values: ["[B06001_024E]", "[B06001_036E]", "[B06001_048E]"]
        drop: YES
      - type: combine_moes
        confidence: 0.9
        column: us_75_and_overM
        values: ["B06001_024M", "B06001_036M", "B06001_048M"]
        drop: YES

    rename:
      GEOID: geo_id
      B06001_050E: foreign_under_5E
      B06001_050M: foreign_under_5M
      B06001_051E: foreign_5_to_17E
      B06001_051M: foreign_5_to_17M
      B06001_052E: foreign_18_to_24E
      B06001_052M: foreign_18_to_24M
      B06001_053E: foreign_25_to_34E
      B06001_053M: foreign_25_to_34M
      B06001_054E: foreign_35_to_44E
      B06001_054M: foreign_35_to_44M
      B06001_055E: foreign_45_to_54E
      B06001_055M: foreign_45_to_54M
      B06001_056E: foreign_55_to_59E
      B06001_056M: foreign_55_to_59M
      B06001_057E: foreign_60_to_61E
      B06001_057M: foreign_60_to_61M
      B06001_058E: foreign_62_to_64E
      B06001_058M: foreign_62_to_64M
      B06001_059E: foreign_65_to_74M
      B06001_059M: foreign_65_to_74E
      B06001_060E: foreign_75_and_olderM
      B06001_060M: foreign_75_and_olderE

tables:
  "yg_nativity_age":
    pk: ["geo_id"]
    agg: sum

