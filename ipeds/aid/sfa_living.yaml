inherits: ["db.yaml"]

global:
  zip:
    target_name: ef201Xa_rv.csv
  seperator: ","
  name: ipeds
  use_schema: True
  encoding: utf-8-sig
  strip_column_whitespace: True
  na_values: ['']
  source_vars:
    year: [2012, 2013, 2014, 2015]
  type:
    UNITID: str
    CIPCODE: str
  source : "data/ipeds/enrollment/aid/sfa/sfa<year>.zip"
  output : "data/output/ipeds/aid/sfa/sfa<year>"

  web_paths:
    "2015": "https://nces.ed.gov/ipeds/datacenter/data/SFA1415.zip"
    "2014": "https://nces.ed.gov/ipeds/datacenter/data/SFA1314.zip"
    "2013": "https://nces.ed.gov/ipeds/datacenter/data/SFA1213.zip"
    "2012": "https://nces.ed.gov/ipeds/datacenter/data/SFA1112.zip"

  add_pks: True

  db_settings:
    type:
      university: text
      year: integer
      num_in_living_arrangement: float

  usecols:
    - UNITID
    - GISTON2
    - GISTWF2
    - GISTOF2
    - GISTUN2

  rename:
    UNITID: university
    GISTON2: num_living_oncampus
    GISTWF2: num_living_offcampuswithfamily
    GISTOF2: num_living_offcampusnotwithfamily
    GISTUN2: num_living_unknown

  transform:
    - type: plugin
      func: ipeds.plugins.sfa.transform_living
      pk: [year, university]
      raw_mode: True


  regex_drop:
    "^X<anything>": "delete"

tables:
  # calculates students living arrangements in SFA cohort

  living_sfa_yu:
    pk: [year, university]
    agg: sum
    post_agg_transform:
      - type: drop
        column: living_arrangement
      - type: plugin
        func: ipeds.plugins.carnegie.add_rows
        pk: ['year', 'university']
        raw_mode: True
        default_agg: median

  living_sfa_ya:
    pk: [year, living_arrangement]
    agg: sum
    post_agg_transform:
      - type: drop
        column: university

  living_sfa_yua:
    pk: [year, university, living_arrangement]

    post_agg_transform:
      - type: plugin
        func: ipeds.plugins.carnegie.add_rows
        pk: ['year', 'university', 'living_arrangement']
        raw_mode: True
        default_agg: median
