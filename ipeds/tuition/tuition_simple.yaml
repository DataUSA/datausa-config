inherits: ["db.yaml"]

global:
    seperator: ","
    name: ipeds
    use_schema: True
    encoding: utf-8-sig
    strip_column_whitespace: True
    source_vars:
      year:
        start: 2013
        end: 2016


    source: "data/ipeds/simpletuition/ic<year>_ay.zip"
    output : "data/output/ipeds/tuition/simpletuition/<year>"
    na_values: ['.']
    usecols: ["UNITID", "TUITION1", "TUITION2", "TUITION3", "TUITION5", "TUITION6", "TUITION7", "FEE1", "FEE2", "FEE3", "FEE5", "FEE6", "FEE7", "CHG4AY2", "CHG1AT2", "CHG1AF2", "CHG1AY2", "CHG2AT2", "CHG2AF2", "CHG2AY2", "CHG3AT2", "CHG3AF2", "CHG3AY2"]

    rename:
      UNITID: university
      TUITION1: district_tuition
      FEE1: district_fee
      TUITION2: state_tuition
      FEE2: state_fee
      TUITION3: oos_tuition
      FEE3: oos_fee
      TUITION5: district_tuition_grads
      FEE5: district_fee_grads
      TUITION6: state_tuition_grads
      FEE6: state_fee_grads
      TUITION7: oos_tuition_grads
      FEE7: oos_fee_grads
      CHG4AY2: books_and_supplies
      CHG1AT2: published_district_tuition
      CHG1AF2: published_district_fee
      CHG1AY2: published_district_tuition_and_fee
      CHG2AT2: published_state_tuition
      CHG2AF2: published_state_fee
      CHG2AY2: published_state_tuition_and_fee
      CHG3AT2: published_oos_tuition
      CHG3AF2: published_oos_fee
      CHG3AY2: published_oos_tuition_and_fee

    web_paths: "https://nces.ed.gov/ipeds/datacenter/data/ic<year>_ay.zip"

    fillna:
      mode: True
      value: 0

    import_to_db: True
    adds_pks: True
    db_settings:
      type:
        university: text
        district_tuition: real
        district_fee: real
        state_tuition: real
        state_fee: real
        oos_tuition: real
        oos_fee: real
        district_tuition_grads: real
        district_fee_grads: real
        state_tuition_grads: real
        state_fee_grads: real
        oos_tuition_grads: real
        oos_fee_grads: real
        books_and_supplies: real
        published_district_tuition: real
        published_district_fee: real
        published_district_tuition_and_fee: real
        published_state_tuition: real
        published_state_fee: real
        published_state_tuition_and_fee: real
        published_oos_tuition: real
        published_oos_fee: real
        published_oos_tuition_and_fee: real
    deduplicate: True

    agg:
      district_tuition: median
      district_fee: median
      state_tuition: median
      state_fee: median
      oos_tuition: median
      oos_fee: median
      district_tuition_grads: median
      district_fee_grads: median
      state_tuition_grads: median
      state_fee_grads: median
      oos_tuition_grads: median
      oos_fee_grads: median
      books_and_supplies: median
      published_district_tuition: median
      published_district_fee: median
      published_district_tuition_and_fee: median
      published_state_tuition: median
      published_state_fee: median
      published_state_tuition_and_fee: median
      published_oos_tuition: median
      published_oos_fee: median
      published_oos_tuition_and_fee: median

tables:
  tuition_yu_v2:
    pk: ["year", "university"]

    post_agg_transform:
      - column: oos_tuition_rank
        type: rank
        target: oos_tuition
      - column: state_tuition_rank
        type: rank
        target: state_tuition
      - type: plugin
        func: ipeds.plugins.carnegie.add_rows
        pk: [year, university, university_level]
        raw_mode: True
        default_agg: median
