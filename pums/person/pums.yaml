global:
    seperator: ","
    name: pums
    use_schema: True
    source : "/tmp/pums_entire_usa/<year>/<est>/csv_pus.zip"
    # source: "/tmp/test<year>_<est>.csv"
    source_vars:
        year:
            start: 2006
            end: 2013
        est:
            start: 1
            end: 1

    archive_files: "csv"
    strip_column_whitespace: True
    force_column_uppercase:
        exclude: ["year", "est", "geo_id", "naics", "num_households", "num_ppl", "num_records"]
    output : "/tmp/pums_output/<year>/<est>/"
    web_paths:
        "2005": "http://www2.census.gov/acs/downloads/pums/<year>/csv_pus.zip"
        "2006": "http://www2.census.gov/acs/downloads/pums/<year>/csv_pus.zip"
        pums: "ftp://ftp.census.gov/acs<year>_<est>yr/pums/csv_pus.zip"
    # type must be the original name of the column (before rename)
    type:
        occp02: "str"
        naicsp02: "str"
        naicsp07: "str"
        occp10 : "str"
        ST: "str"
        AGEP: "int"

    agg: "sum"

    import_to_db: True
    db_settings:
        user: postgres
        password_env_var: DATAUSA_PW
        host: 162.209.124.219
        db_name: datausa

    transform:
        df:
            type: frame_func
            func: "plugins.census.pums.process"
            sumlevel: "puma"
            values:
                    -
                        column: WAGP
                        name: avg_wage
                    -
                        column: AGEP
                        name: avg_age

    named_transforms:
        pums_state:
            type: frame_func
            func: "plugins.census.pums.process"
            sumlevel: "state"
            values:
                    -
                        column: WAGP
                        name: avg_wage
                    -
                        column: AGEP
                        name: avg_age

        pums_nation:
            type: frame_func
            func: "plugins.census.pums.process"
            sumlevel: "nation"
            values:
                    -
                        column: WAGP
                        name: avg_wage
                    -
                        column: AGEP
                        name: avg_age

tables:
   nation_yegi:
        pk: ["year", "est", "geo_id", "naics"]
        transform:
            df: pums_nation
   state_yegi:
        pk: ["year", "est", "geo_id", "naics"]
        transform:
            df: pums_state
   puma_yegi:
        pk: ["year", "est", "geo_id", "naics"]



   nation_yego:
        pk: ["year", "est", "geo_id", "soc"]
        transform:
            df: pums_nation
   state_yego:
        pk: ["year", "est", "geo_id", "soc"]
        transform:
            df: pums_state
   puma_yego:
        pk: ["year", "est", "geo_id", "soc"]



   nation_yegio:
        pk: ["year", "est", "geo_id", "naics", "soc"]
        transform:
            df: pums_nation
   state_yegio:
        pk: ["year", "est", "geo_id", "naics", "soc"]
        transform:
            df: pums_state
   puma_yegio:
        pk: ["year", "est", "geo_id", "naics", "soc"]

