default_values: &defaults
    -
        column: WAGP
        name: avg_wage
        apply_inflation: True
    -
        column: age
        name: avg_age
    -
        column: WKHP
        name: avg_hrs

global:
    seperator: ","
    name: pums_beta
    use_schema: True
    source : "/tmp/pums_entire_usa/<year>/<est>/csv_pus.zip"
    # source: "/tmp/test<year>_<est>.csv"
    usecols: ['NATIVITY', 'POBP', 'WKHP', 'FOD1P', 'RAC1P', 'ADJINC', 'ESR', 'PWGTP', 'SCHL', 'ST', 'WAGP', 'SOCP', 'NAICSP', 'SEX', 'AGEP', 'PUMA', 'pwgtp1', 'pwgtp2', 'pwgtp3', 'pwgtp4', 'pwgtp5', 'pwgtp6', 'pwgtp7', 'pwgtp8', 'pwgtp9', 'pwgtp10', 'pwgtp11', 'pwgtp12', 'pwgtp13', 'pwgtp14', 'pwgtp15', 'pwgtp16', 'pwgtp17', 'pwgtp18', 'pwgtp19', 'pwgtp20', 'pwgtp21', 'pwgtp22', 'pwgtp23', 'pwgtp24', 'pwgtp25', 'pwgtp26', 'pwgtp27', 'pwgtp28', 'pwgtp29', 'pwgtp30', 'pwgtp31', 'pwgtp32', 'pwgtp33', 'pwgtp34', 'pwgtp35', 'pwgtp36', 'pwgtp37', 'pwgtp38', 'pwgtp39', 'pwgtp40', 'pwgtp41', 'pwgtp42', 'pwgtp43', 'pwgtp44', 'pwgtp45', 'pwgtp46', 'pwgtp47', 'pwgtp48', 'pwgtp49', 'pwgtp50', 'pwgtp51', 'pwgtp52', 'pwgtp53', 'pwgtp54', 'pwgtp55', 'pwgtp56', 'pwgtp57', 'pwgtp58', 'pwgtp59', 'pwgtp60', 'pwgtp61', 'pwgtp62', 'pwgtp63', 'pwgtp64', 'pwgtp65', 'pwgtp66', 'pwgtp67', 'pwgtp68', 'pwgtp69', 'pwgtp70', 'pwgtp71', 'pwgtp72', 'pwgtp73', 'pwgtp74', 'pwgtp75', 'pwgtp76', 'pwgtp77', 'pwgtp78', 'pwgtp79', 'pwgtp80']
    source_vars:
        year: [2013]
        est: [1]
        #geo_level: ["nation", "state", "puma"]
    # post_agg_add_pklengths: True

    archive_files: "csv"
    strip_column_whitespace: True
    force_column_uppercase:
        exclude: ["year", "est", "geo_id", "naics", "num_households", "num_ppl", "num_records", "country", "native"]
    output : "/tmp/pums_output/<year>/<est>/"
    web_paths:
        pums: "http://ftp.census.gov/acs<year>_<est>yr/pums/csv_pus.zip"
    rename:
        AGEP: age
        SEX: sex
        RAC1P: race
        FOD1P: cip
        SCHL: degree
        NATIVITY: native
        POBP: birthplace

    type:
        occp02: "str"
        naicsp02: "str"
        naicsp07: "str"
        occp10 : "str"
        ST: "str"
        AGEP: "int"
        FOD1P: str

    agg: "sum"

    import_to_db: True
    db_settings:
        user: postgres
        password_env_var: DATAUSA_PW
        host: 162.209.124.219
        db_name: datausa
        type:
            degree: text
    deduplicate: True

tables:
    yca:
        pk: ["year", "cip", "age"]
        rca:
            index: ["year", "cip"]
            column: "age"
            values: [num_ppl]
        values: *defaults

    ycb:
        pk: ["year", "cip", "birthplace"]
        rca:
            index: ["year", "cip"]
            column: "birthplace"
            values: [num_ppl]
        values: *defaults

    ycd:
        pk: ["year", "cip", "degree"]
        rca:
            index: ["year", "cip"]
            column: "degree"
            values: [num_ppl]
        values: *defaults

    ycgb:
        pk: ["year", "cip", "geo_id", "birthplace"]
        sumlevel: state
        rca:
            index: ["year", "cip", "geo_id"]
            column: "birthplace"
            values: [num_ppl]
        values: *defaults

    ycn:
        pk: ["year", "cip", "native"]
        rca:
            index: ["year", "cip"]
            column: "native"
            values: [num_ppl]
        values: *defaults

    yoc:
        pk: ["year", "soc", "cip"]
        depths:
            soc: [0, 1, 2, 3]
        rca:
            index: ["year", "soc"]
            column: "cip"
            values: [num_ppl]
        values: *defaults

    ycr:
        pk: ["year", "cip", "race"]
        rca:
            index: ["year", "cip"]
            column: "race"
            values: [num_ppl]
        values: *defaults

    ycs:
        pk: ["year", "cip", "sex"]
        rca:
            index: ["year", "cip"]
            column: "sex"
            values: [num_ppl]
        values: *defaults

    ycsr:
        pk: ["year", "cip", "sex", "race"]
        rca:
            index: ["year", "cip", "sex"]
            column: "race"
            values: [num_ppl]
        values: *defaults

    yc:
        pk: ["year", "cip"]
        values: *defaults
        post_agg_transform:
            -
                column: avg_wage_rank
                type: rank
                target: avg_wage
                where:
                    column: num_records
                    func: gt
                    value: 5
    ygc:
        table_vars:
            geo_level: ["nation", "state", "puma"]
        pk: ["year", "geo_id", "cip"]
        rca:
            index: ["year", "geo_id"]
            column: "cip"
            values: [num_ppl]
        sumlevel: <geo_level>

    ygcd:
        pk: ["year", "geo_id", "cip", "degree"]
        table_vars:
            geo_level: ["nation", "state", "puma"]
        rca:
            index: ["year", "geo_id", "cip"]
            column: "degree"
            values: [num_ppl]
        sumlevel: <geo_level>
        values: *defaults

    ygc:
        pk: ["year", "geo_id", "cip"]
        table_vars:
            geo_level: ["nation", "state", "puma"]
        rca:
            index: ["year", "geo_id"]
            column: "cip"
            values: [num_ppl]
        sumlevel: <geo_level>
        values: *defaults
    yocd:
        pk: ["year", "soc", "cip", "degree"]
        depths:
            soc: [0, 1, 2, 3]
        rca:
            index: ["year", "soc", "cip"]
            column: "degree"
            values: [num_ppl]
        values: *defaults
