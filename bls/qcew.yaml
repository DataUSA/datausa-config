where_county: &where_county
    column: agglvl_code
    func: "eq"
    value: 70

where_state: &where_state
    column: agglvl_code
    func: "eq"
    value: "50"

where_msa: &where_msa
    column: agglvl_code
    func: "eq"
    value: "40"

where_us: &where_us
    column: agglvl_code
    func: "eq"
    value: "10"


global:
    source: "data/bls/20<year>_annual_singlefile.zip"
    web_paths: http://www.bls.gov/cew/data/files/20<year>/csv/20<year>_annual_singlefile.zip
    name: bls
    use_schema: True
    na_values: [".", ]
    source_vars:
        year: [14]
        geo_level: ["70"]
    output : "data/output/bls/qcew/<year>"
    type:
        area_fips: str
        agglvl_code: str
    nrows: 10000
    rename:
        industry_code: naics
        area_fips: geo_id

    transform:
        -
            column: year
            type: add
            value: 2000
        -
            column: geo_id
            type: concat_and_fill
            prefix: "05000US"
            where:
                column: agglvl_code
                func: eq
                value: "70"
        # -
        #     column: geo_id
        #     type: concat_and_fill
        #     prefix: "04000US"
        #     where: *where_state
        # -
        #     column: geo_id
        #     type: set_val
        #     value: "01000US"
        #     where: *where_us
        # -
        #     column: geo_id
        #     type: concat_and_fill
        #     prefix: "31000US"
        #     where: *where_msa

    import_to_db: True
    db_settings:
        user: postgres
        password_env_var: DATAUSA_PW
        host: 162.209.124.219
        db_name: datausa
        type:
            total_annual_wages: real
            taxable_annual_wages: real


tables:
    qcew_ygi:
        pk: ["year", "geo_id", "naics"]
        filter:
            -
                column: size_code
                func: "ne"
                value: 0
            - 
                column: own_code
                func: "ne"
                value: 0
            -
                column: agglvl_code
                func: "ne"
                value: "<geo_level>"      
        agg:
            annual_avg_estabs: sum
            annual_avg_emplvl: sum
            annual_contributions: sum
            total_annual_wages: sum
            taxable_annual_wages: sum
            annual_avg_wkly_wage: sum
            avg_annual_pay: sum

        rca:
            index: ["year", "geo_id"]
            column: "naics"
            values: [annual_avg_emplvl]