inherits: ["db.yaml"]

global:
  zip:
    target_name: gr201X_rv.csv
  seperator: ","
  name: ipeds
  use_schema: True
  encoding: utf-8-sig
  strip_column_whitespace: True
  na_values: ['']
  source_vars:
    year: [2012, 2013, 2014, 2015]
  type:
    UNITID: str
  source : "data/ipeds/grads/demographics/grate_demog_<year>.zip"
  output : "data/output/grads/demographics/grate_demog_<year>"

  web_paths: "https://nces.ed.gov/ipeds/datacenter/data/GR<year>.zip"

  add_pks: True

  db_settings:
    type:
      university: text
      year: integer

  rename:
    UNITID: university
    CHRTSTAT: chrtstat
    GRTYPE: grtype
    LINE: line
    GRTOTLT: completers_total
    GRTOTLM: completers_men_total
    GRTOTLW: completers_women_total
    GRAIANT: completers_native_total
    GRAIANM: completers_native_men
    GRAIANW: completers_native_women
    GRASIAT: completers_asian_total
    GRASIAM: completers_asian_men
    GRASIAW: completers_asian_women
    GRBKAAT: completers_black_total
    GRBKAAM: completers_black_men
    GRBKAAW: completers_black_women
    GRHISPT: completers_hispanic_total
    GRHISPM: completers_hispanic_men
    GRHISPW: completers_hispanic_women
    GRNHPIT: completers_native_total
    GRNHPIM: completers_native_men
    GRNHPIW: completers_native_women
    GRWHITT: completers_white_total
    GRWHITM: completers_white_men
    GRWHITW: completers_white_women
    GR2MORT: completers_multiracial_total
    GR2MORM: completers_multiracial_men
    GR2MORW: completers_multiracial_women
    GRUNKNT: completers_unknown_total
    GRUNKNM: completers_unknown_men
    GRUNKNW: completers_unknown_women
    GRNRALT: completers_nonresident_total
    GRNRALM: completers_nonresident_men
    GRNRALW: completers_nonresident_women


  regex_drop:
    "^X<anything>": "delete"

  transform:
    - type: filter
      column: chrtstat
      func: "isin"
      value: [12, 13]
    - type: filter
      column: line
      func: "isin"
      value: ["999"]

tables:
  # calculates students living arrangements in SFA cohort
  gradrate_gr_yu:
    pk: [year, university]

    post_agg_transform:
      - type: plugin
        func: ipeds.plugins.grads.transform_grad_rate_race
        pk: [year, university]
        raw_mode: True
      - type: plugin
        func: ipeds.plugins.carnegie.add_rows
        pk: [year, university, university_level]
        raw_mode: True
        default_agg: median

  gradrate_gr_yus:
    pk: [year, university, sex]

    post_agg_transform:
      - type: plugin
        func: ipeds.plugins.grads.transform_grad_rate_race
        pk: [year, university, sex]
        raw_mode: True
      - type: plugin
        func: ipeds.plugins.carnegie.add_rows
        pk: [year, university, sex, university_level]
        raw_mode: True
        default_agg: median


  gradrate_gr_yur:
    pk: [year, university, ipeds_race]

    post_agg_transform:
      - type: plugin
        func: ipeds.plugins.grads.transform_grad_rate_race
        pk: [year, university, ipeds_race]
        raw_mode: True
      - type: plugin
        func: ipeds.plugins.carnegie.add_rows
        pk: [year, university, ipeds_race, university_level]
        raw_mode: True
        default_agg: median


  gradrate_gr_yusr:
    pk: [year, university, sex, ipeds_race]

    post_agg_transform:
      - type: plugin
        func: ipeds.plugins.grads.transform_grad_rate_race
        pk: [year, university, sex, ipeds_race]
        raw_mode: True
      - type: plugin
        func: ipeds.plugins.carnegie.add_rows
        pk: [year, university, sex, ipeds_race, university_level]
        raw_mode: True
        default_agg: median
