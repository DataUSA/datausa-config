inherits: ["db.yaml"]

global:
  seperator: ","
  name: ipeds
  use_schema: True
  encoding: utf-8-sig
  strip_column_whitespace: True
  na_values: ['']
  concat: YES
  concat_border: year
  source_vars:
    year: [2012, 2013, 2014, 2015]
    mode: [gasb, fasb]

  type:
    UNITID: str

  source : "data/ipeds/finance/<mode>/<year>.zip"
  output : "data/output/ipeds/finance/<mode>/<year>"

  web_paths:
    "gasb/2015": "https://nces.ed.gov/ipeds/datacenter/data/F1415_F1A.zip"
    "fasb/2015": "https://nces.ed.gov/ipeds/datacenter/data/F1415_F2.zip"

    "gasb/2014": "https://nces.ed.gov/ipeds/datacenter/data/F1314_F1A.zip"
    "fasb/2014": "https://nces.ed.gov/ipeds/datacenter/data/F1314_F2.zip"

    "gasb/2013": "https://nces.ed.gov/ipeds/datacenter/data/F1213_F1A.zip"
    "fasb/2013": "https://nces.ed.gov/ipeds/datacenter/data/F1213_F2.zip"

    "gasb/2012": "https://nces.ed.gov/ipeds/datacenter/data/F1112_F1A.zip"
    "fasb/2012": "https://nces.ed.gov/ipeds/datacenter/data/F1112_F2.zip"


  add_pks: True

  db_settings:
    type:
      university: text
      investment_income: float
      tuition_and_fees: float

  rename:
    UNITID: university

    F1H02: endowment_value_fiscal_year_end
    F2H02: endowment_value_fiscal_year_end

  regex_drop:
    "^X<anything>": "delete"

tables:
  financials_endowmentquintiles_yu:
    pk: [year, university]

    agg:
      endowment_value_fiscal_year_end: sum
      mode: sum

    post_agg_transform:
      - type: plugin
        func: ipeds.plugins.carnegie.add_rows
        pk: [year, university]
        raw_mode: True
        default_agg: median
        aggs_dict:
          mode: mode
      - type: plugin
        func: ipeds.plugins.financials.compute_quintiles
