inherits: ["db.yaml"]

global:
  seperator: ","
  name: ipeds
  use_schema: True
  encoding: utf-8-sig
  strip_column_whitespace: True
  na_values: ['']
  source_vars:
    year: [2016]

  type:
    UNITID: str
  source : "data/ipeds/admissions/ADM<year>.zip"
  output : "data/output/ipeds/admissions/<year>"

  web_paths: "https://nces.ed.gov/ipeds/datacenter/data/ADM<year>.zip"

  add_pks: True

  db_settings:
    type:
      university: text
      applicants_total: float
      applicants_men: float
      applicants_women: float
      admissions_total: float
      admissions_men: float
      admissions_women: float
      admissions_enrolled_total: float
      admissions_enrolled_men: float
      admissions_enrolled_women: float
      admissions_enrolled_ft_total: float
      admissions_enrolled_ft_men: float
      admissions_enrolled_ft_women: float
      admissions_enrolled_pt_total: float
      admissions_enrolled_pt_men: float
      admissions_enrolled_pt_women: float
      sub_sat_scores_num: float
      sub_act_scores_num: float
      sub_sat_scores_pct: float
      sub_act_scores_pct: float
      sat_cr_25: float
      sat_cr_75: float
      sat_math_25: float
      sat_math_75: float
      sat_writing_25: float
      sat_writing_75: float
      act_composite_25: float
      act_composite_75: float
      act_english_25: float
      act_english_75: float
      act_math_25: float
      act_math_75: float
      act_writing_25: float
      act_writing_75: float
  rename:
    UNITID: university
    APPLCN: applicants_total
    APPLCNM: applicants_men
    APPLCNW: applicants_women
    ADMSSN: admissions_total
    ADMSSNM: admissions_men
    ADMSSNW: admissions_women
    ENRLT: admissions_enrolled_total
    ENRLM: admissions_enrolled_men
    ENRLW: admissions_enrolled_women
    ENRLFT: admissions_enrolled_ft_total
    ENRLFTM: admissions_enrolled_ft_men
    ENRLFTW: admissions_enrolled_ft_women
    ENRLPT: admissions_enrolled_pt_total
    ENRLPTM: admissions_enrolled_pt_men
    ENRLPTW: admissions_enrolled_pt_women
    SATNUM: sub_sat_scores_num
    ACTNUM: sub_act_scores_num
    SATPCT: sub_sat_scores_pct
    ACTPCT: sub_act_scores_pct
    SATVR25: sat_cr_25
    SATVR75: sat_cr_75
    SATMT25: sat_math_25
    SATMT75: sat_math_75
    # SATWR25: sat_writing_25
    # SATWR75: sat_writing_75
    ACTCM25: act_composite_25
    ACTCM75: act_composite_75
    ACTEN25: act_english_25
    ACTEN75: act_english_75
    ACTMT25: act_math_25
    ACTMT75: act_math_75
    # ACTWR25: act_writing_25
    # ACTWR75: act_writing_75

  regex_drop:
    "^X<anything>": "delete"

tables:
  adm_undergrad_y:
    pk: [year]
    agg:
      ADMCON1: mode
      ADMCON2: mode
      ADMCON3: mode
      ADMCON4: mode
      ADMCON5: mode
      ADMCON6: mode
      ADMCON7: mode
      ADMCON8: mode
      ADMCON9: mode
      applicants_total: median
      applicants_men: median
      applicants_women: median
      admissions_total: median
      admissions_men: median
      admissions_women: median
      admissions_enrolled_total: median
      admissions_enrolled_men: median
      admissions_enrolled_women: median
      admissions_enrolled_ft_total: median
      admissions_enrolled_ft_men: median
      admissions_enrolled_ft_women: median
      admissions_enrolled_pt_total: median
      admissions_enrolled_pt_men: median
      admissions_enrolled_pt_women: median
      sub_sat_scores_num: median
      sub_act_scores_num: median
      sub_sat_scores_pct: median
      sub_act_scores_pct: median
      sat_cr_25: median
      sat_cr_75: median
      sat_math_25: median
      sat_math_75: median
      # sat_writing_25: median
      # sat_writing_75: median
      act_composite_25: median
      act_composite_75: median
      act_english_25: median
      act_english_75: median
      act_math_25: median
      act_math_75: median
      # act_writing_25: median
      # act_writing_75: median
      yield_total: median
      yield_men: median
      yield_women: median

    transform:
      - type: plugin
        func: ipeds.plugins.admissions.compute_yields

  adm_undergrad_yu:
    pk: [year, university]

    transform:
      - type: plugin
        func: ipeds.plugins.admissions.compute_yields
      - type: plugin
        func: ipeds.plugins.carnegie.add_rows
        pk: [year, university]
        raw_mode: True
        default_agg: median
        aggs_dict:
          ADMCON1: mode
          ADMCON2: mode
          ADMCON3: mode
          ADMCON4: mode
          ADMCON5: mode
          ADMCON6: mode
          ADMCON7: mode
          ADMCON8: mode
          ADMCON9: mode
