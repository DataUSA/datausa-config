global:
    seperator: ","
    name: pums
    use_schema: True
    source : "/home/hermes/pums_entire_usa/<year>/<est>/csv_pus.zip"
    # source: "/tmp/test<year>_<est>.csv"
    source_vars:
        year:
            start: 2005
            end: 2013
        est:
            start: 1
            end: 1

    archive_files: "csv"
    strip_column_whitespace: True
    force_column_uppercase:
        exclude: ["year", "est", "geo_id"]
    output : "/home/hermes/pums_output/<year>/<est>/"
    web_paths:
        "2005": "http://www2.census.gov/acs/downloads/pums/<year>/csv_pus.zip"
        "2006": "http://www2.census.gov/acs/downloads/pums/<year>/csv_pus.zip"
        pums: "ftp://ftp.census.gov/acs<year>_<est>yr/pums/csv_pus.zip"
    # type must be the original name of the column (before rename)
    type:
        occp02: "str"
        naicsp02: "str"
        naicsp07: "str"
        occp10 : "str"
        ST: "str"
        AGEP: "int"

    agg: "sum"

    import_to_db: True
    db_settings:
        user: postgres
        password_env_var: DATAUSA_PW
        host: 162.209.124.219
        db_name: postgres

    transform:
        df:
            type: frame_func
            func: "plugins.census.pums.process"
            sumlevel: "puma"
            values:
                    -
                        column: WAGP
                        name: avg_wage
                    -
                        column: AGEP
                        name: avg_age

tables:
    puma_yeg:
        pk: ["year", "est", "geo_id"]

    state_yeg:
        pk: ["year", "est", "geo_id"]
        transform:
            df:
                type: frame_func
                func: "plugins.census.pums.process"
                sumlevel: "state"
                values:
                    -
                        column: WAGP
                        name: avg_wage
                    -
                        column: AGEP
                        name: avg_age

    nation_ye:
        pk: ["year", "est", "geo_id"]
        transform:
            df:
                type: frame_func
                func: "plugins.census.pums.process"
                sumlevel: "nation"
                values:
                    -
                        column: WAGP
                        name: avg_wage
                    -
                        column: AGEP
                        name: avg_age
