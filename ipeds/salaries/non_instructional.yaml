inherits: ["db.yaml"]

global:
  zip:
    target_name: sal201X_nis_rv.csv
  seperator: ","
  name: ipeds
  use_schema: True
  encoding: utf-8-sig
  strip_column_whitespace: True
  na_values: ['']
  source_vars:
    year: [2012, 2013, 2014, 2015]
  type:
    UNITID: str
    ipeds_occ: str
  source : "data/ipeds/salaries/nis/sal<year>nis.zip"
  output : "data/output/salaries/nis/sal<year>nis"

  web_paths: "https://nces.ed.gov/ipeds/datacenter/data/SAL<year>_NIS.zip"

  add_pks: True

  db_settings:
    type:
      university: text
      outlays_noninstructional_staff: real
      num_noninstructional_staff: real
      ipeds_occ: text
  rename:
    UNITID: university

  regex_drop:
    "^X<anything>": "delete"

  filter:
    - column: ipeds_occ
      func: eq
      value: "01"

tables:
  noninstructional_salaries_yu:
    pk: [year, university]
    agg:
      num_noninstructional_staff: sum
      outlays_noninstructional_staff: sum
    transform:
      - type: plugin
        func: ipeds.plugins.salaries.ipeds_occ


    post_agg_transform:
      - type: plugin
        func: ipeds.plugins.carnegie.add_rows
        pk: [year, university]
        raw_mode: True
        default_agg: median

  noninstructional_salaries_yuo:
    pk: [year, university, ipeds_occ]

    transform:
      - type: plugin
        func: ipeds.plugins.salaries.ipeds_occ
      - type: rca
        index: [year, university]
        column: ipeds_occ
        values: [num_noninstructional_staff]
      - type: drop
        column: index
    post_agg_transform:
      - type: plugin
        func: ipeds.plugins.carnegie.add_rows
        pk: [year, university]
        raw_mode: True
        default_agg: median
