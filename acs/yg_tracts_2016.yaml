inherits: ["db.yaml"]

global:
  seperator: ","
  name: acs_<estimate>yr
  use_schema: True
  source_vars:
    year: [2016]
    estimate: [5]
    state: ["01","02","04","05","06","08","09","10","11","12","13","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","44","45","46","47","48","49","50","51","53","54","55","56","72"]
    sumlevel:
      - "tract"

  source: "data/acs_<estimate>yr/<year>_<estimate>_<state>_<sumlevel>.json"
  output: "data/output/acs_<estimate>yr/yg/<year>/<state>_<sumlevel>"

  filetype: json

  web_paths: "http://api.census.gov/data/<year>/acs/acs<estimate>?get=B01002_001E,B01002_001M,B01003_001E,B01003_001M,B19013_001E,B19013_001M,B08006_001E,B08013_001E,B05001_006E,B25003_001E,B25003_002E,B25077_001E,B25077_001M,B16001_001E,B16001_002E&for=<sumlevel>&in=state:<state>&key=$ACS_KEY"

  preprocess:
    func: "src.plugins.preprocess.acs_preprocess"
  transform:
      - type: plugin
        func: src.plugins.census.acs.helper.clean_geoids
        target: <sumlevel>
      - type: rename
        column: "B01002_001E"
        value: "age"
      - type: rename
        column: "B01002_001M"
        value: "age_moe"
      - type: rename
        column: "B01003_001E"
        value: "pop"
      - type: rename
        column: "B01003_001M"
        value: "pop_moe"
      - type: rename
        column: "B19013_001E"
        value: "income"
      - type: rename
        column: "B19013_001M"
        value: "income_moe"
      - type: rename
        column: "B08013_001E"
        value: "mean_commute_minutes"
      - type: rename
        column: "B08006_001E"
        value: "num_commuters"
      - type: rename
        column: "B05001_006E"
        value: "non_us_citizens"
      - type: rename
        column: "B25003_001E"
        value: "num_housing_units"
      - type: rename
        column: "B25003_002E"
        value: "owner_occupied_housing_units"
      - type: rename
        column: "B25077_001E"
        value: "median_property_value"
      - type: rename
        column: "B25077_001M"
        value: "median_property_value_moe"
      - type: rank
        column: "age_rank"
        target: age
      - type: rank
        column: "pop_rank"
        target: pop
      - type: rank
        column: "income_rank"
        target: income
      - type: div
        column: "mean_commute_minutes"
        value: "[num_commuters]"
      - type: div
        column: "non_us_citizens"
        value: "[pop]"
      - type: set_val
        column: us_citizens
        value: 1
      - type: sub
        column: "us_citizens"
        value: "[non_us_citizens]"
      - type: div
        column: "owner_occupied_housing_units"
        value: "[num_housing_units]"
      - type: clone
        column: "total_noneng_speakers"
        source: "B16001_001E"
      - type: sub
        column: "total_noneng_speakers"
        value: "[B16001_002E]"
      - type: div
        column: "total_noneng_speakers"
        value: "[B16001_001E]"
      - type: rename
        column: "total_noneng_speakers"
        value: "non_eng_speakers_pct"

      - type: drop
        strict: NO
        column:
          - us
          - tbl
          - sumlevel
          - column
          - "state"
          - "county"
          - "metropolitan statistical area/micropolitan statistical area"
          - "place"
          - "zip code tabulation area"
          - "public use microdata area"
          - "tract"
          - "num_commuters"
          - "num_housing_units"
          - "B16001_001E"
          - "B16001_002E"

tables:
  yg:
    pk: ["year", "geo"]
